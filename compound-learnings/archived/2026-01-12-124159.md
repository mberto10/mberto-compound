# Compound Learning Artifact

## Session Context
- Date: 2026-01-12
- Plugins used: work-toolkit (weekly-email command, get_kw_updates.py helper)
- Focus: User feedback on weekly-email output quality - two major issues identified

## Summary

Ran `/weekly-email KW02` to compile Lenkungsausschuss update. The helper script initially failed due to a NoneType bug (comments with null text). After fixing that, the KW pattern matching was too narrow (only matched `KW2`, missing `KW 02` and `KW02` variants). More critically, the output dumped all 9 projects into the email without prioritization or curation - the user expected a curated subset of 5-6 most important updates.

## Learnings

### Rules

- KW search patterns must handle all common variants: `KW2`, `KW02`, `KW 02`, `KW 2` using a single flexible regex that works for any week number.
[src:2026-01-12T1241Z__weekly-email-kw02] [type:rule]

- Weekly email output should curate and prioritize 5-6 most significant projects, not dump all projects with updates.
[src:2026-01-12T1241Z__weekly-email-kw02] [type:rule]

### Fixes

- get_kw_updates.py: `comment.get("text", "")` returns `""` only if key is missing, not if value is `None`. Must use `comment.get("text") or ""` to handle null values.
[src:2026-01-12T1241Z__weekly-email-kw02] [type:fix]

- get_kw_updates.py: Regex pattern `rf'\bKW\s*{kw}\b'` fails for single-digit weeks with leading zeros. Pattern must match both `KW2` and `KW02` formats.
[src:2026-01-12T1241Z__weekly-email-kw02] [type:fix]

### Feature Requests

- weekly-email command should include prioritization logic: rank projects by significance (blockers present, substantial progress, strategic importance) and present top 5-6.
[src:2026-01-12T1241Z__weekly-email-kw02] [type:feature]

- weekly-email command should allow user to select which projects to include before generating final email.
[src:2026-01-12T1241Z__weekly-email-kw02] [type:feature]

## Proposed Changes

### work-toolkit: get_kw_updates.py
- **File:** helper_tools/youtrack/get_kw_updates.py
- **Change type:** update
- **Description:**
  1. Fix null text handling: `text = comment.get("text") or ""`
  2. Improve KW pattern to handle all variants for any week number: Match `KW` followed by optional space, optional leading zero, then the week number
- **Priority:** high

### work-toolkit: weekly-email.md
- **File:** commands/weekly-email.md
- **Change type:** update
- **Description:**
  1. Add step to curate/prioritize projects before email generation
  2. Define prioritization criteria (blockers > progress > strategic projects)
  3. Target 5-6 projects per email, not all
  4. Add interactive selection step before final output
- **Priority:** high

## Raw Observations

**Classification:**
- KW pattern fix: **Frontier-shifting** + **Real friction** - Improves underlying capability (correct data retrieval) so both coverage AND accuracy improve. Emerged from actual session failure.
- Email curation: **Frontier-shifting** + **Real friction** - The current "dump everything" approach doesn't serve the actual use case. A Lenkungsausschuss email should be scannable, highlighting what matters. This improves signal/noise ratio which benefits both reader experience AND author efficiency.
- Null text fix: **Sliding** (minor bug fix) + **Real friction** - Prevents crashes but doesn't shift capabilities significantly.

**Root cause insight:** The weekly-email command was designed as a "collect and format" utility but the actual need is "collect, curate, and format" - the curation step is missing from the workflow design.
